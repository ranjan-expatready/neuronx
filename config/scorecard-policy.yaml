# Scorecard Policy Configuration - WI-065: Scorecard Engine & Analytics Integration
#
# Policy-driven metric definitions, thresholds, and banding for NeuronX scorecards.
# All thresholds are configurable and versioned for auditability.

version: '1.0.0'
description: 'NeuronX Scorecard Metrics and Thresholds Policy'

# Global settings
global:
  enabledSurfaces: ['OPERATOR', 'MANAGER', 'EXECUTIVE']
  defaultTimeRanges: ['7d', '30d', '90d']
  trendCalculationEnabled: true

# Metric definitions by category
metrics:
  # SALES EFFECTIVENESS METRICS
  salesEffectiveness:
    lead_to_contact_rate:
      key: 'lead_to_contact_rate'
      label: 'Lead to Contact Rate'
      description: 'Percentage of leads that become contacts'
      unit: 'percentage'
      enabled: true
      surfaces: ['OPERATOR', 'MANAGER', 'EXECUTIVE']
      source: 'fsm'
      queryType: 'state_transitions'
      thresholds:
        green: { min: 75, max: 100 } # 75%+ is excellent
        yellow: { min: 50, max: 74 } # 50-74% needs attention
        red: { min: 0, max: 49 } # <50% is critical

    contact_to_qualified_rate:
      key: 'contact_to_qualified_rate'
      label: 'Contact to Qualified Rate'
      description: 'Percentage of contacts that become qualified opportunities'
      unit: 'percentage'
      enabled: true
      surfaces: ['OPERATOR', 'MANAGER', 'EXECUTIVE']
      source: 'fsm'
      queryType: 'state_transitions'
      thresholds:
        green: { min: 60, max: 100 }
        yellow: { min: 30, max: 59 }
        red: { min: 0, max: 29 }

    qualified_to_booked_rate:
      key: 'qualified_to_booked_rate'
      label: 'Qualified to Booked Rate'
      description: 'Percentage of qualified opportunities that get booked'
      unit: 'percentage'
      enabled: true
      surfaces: ['MANAGER', 'EXECUTIVE']
      source: 'fsm'
      queryType: 'state_transitions'
      thresholds:
        green: { min: 40, max: 100 }
        yellow: { min: 20, max: 39 }
        red: { min: 0, max: 19 }

    booked_to_consult_done_rate:
      key: 'booked_to_consult_done_rate'
      label: 'Booked to Consult Done Rate'
      description: 'Percentage of booked calls that complete successfully'
      unit: 'percentage'
      enabled: true
      surfaces: ['OPERATOR', 'MANAGER', 'EXECUTIVE']
      source: 'fsm'
      queryType: 'state_transitions'
      thresholds:
        green: { min: 85, max: 100 }
        yellow: { min: 70, max: 84 }
        red: { min: 0, max: 69 }

    consult_done_to_paid_rate:
      key: 'consult_done_to_paid_rate'
      label: 'Consult Done to Paid Rate'
      description: 'Percentage of completed consults that convert to paid'
      unit: 'percentage'
      enabled: true
      surfaces: ['MANAGER', 'EXECUTIVE']
      source: 'billing'
      queryType: 'conversion_tracking'
      thresholds:
        green: { min: 50, max: 100 }
        yellow: { min: 25, max: 49 }
        red: { min: 0, max: 24 }

    no_show_rate:
      key: 'no_show_rate'
      label: 'No Show Rate'
      description: 'Percentage of booked calls that result in no-shows'
      unit: 'percentage'
      enabled: true
      surfaces: ['OPERATOR', 'MANAGER']
      source: 'fsm'
      queryType: 'state_transitions'
      thresholds:
        green: { min: 0, max: 5 } # <5% is excellent
        yellow: { min: 6, max: 15 } # 6-15% needs attention
        red: { min: 16, max: 100 } # >15% is critical

    avg_time_in_new_state:
      key: 'avg_time_in_new_state'
      label: 'Avg Time in NEW State'
      description: 'Average time leads spend in NEW state before contact attempt'
      unit: 'hours'
      enabled: true
      surfaces: ['OPERATOR', 'MANAGER']
      source: 'fsm'
      queryType: 'time_in_state'
      thresholds:
        green: { min: 0, max: 24 } # <24 hours is excellent
        yellow: { min: 25, max: 72 } # 1-3 days needs attention
        red: { min: 73, max: 999999 } # >3 days is critical

  # OPERATIONAL EXCELLENCE METRICS
  operationalExcellence:
    sla_breach_rate:
      key: 'sla_breach_rate'
      label: 'SLA Breach Rate'
      description: 'Percentage of opportunities that breach SLA deadlines'
      unit: 'percentage'
      enabled: true
      surfaces: ['OPERATOR', 'MANAGER', 'EXECUTIVE']
      source: 'fsm'
      queryType: 'sla_tracking'
      thresholds:
        green: { min: 0, max: 2 } # <2% is excellent
        yellow: { min: 3, max: 8 } # 3-8% needs attention
        red: { min: 9, max: 100 } # >8% is critical

    sla_at_risk_count:
      key: 'sla_at_risk_count'
      label: 'SLA At-Risk Count'
      description: 'Number of opportunities currently at risk of SLA breach'
      unit: 'count'
      enabled: true
      surfaces: ['OPERATOR', 'MANAGER', 'EXECUTIVE']
      source: 'fsm'
      queryType: 'sla_tracking'
      thresholds:
        green: { min: 0, max: 0 } # 0 is excellent
        yellow: { min: 1, max: 10 } # 1-10 needs attention
        red: { min: 11, max: 999999 } # >10 is critical

    execution_success_rate:
      key: 'execution_success_rate'
      label: 'Execution Success Rate'
      description: 'Percentage of execution commands that succeed'
      unit: 'percentage'
      enabled: true
      surfaces: ['OPERATOR', 'MANAGER', 'EXECUTIVE']
      source: 'audit_log'
      queryType: 'execution_audit'
      thresholds:
        green: { min: 95, max: 100 } # 95%+ is excellent
        yellow: { min: 85, max: 94 } # 85-94% needs attention
        red: { min: 0, max: 84 } # <85% is critical

    retry_rate:
      key: 'retry_rate'
      label: 'Retry Rate'
      description: 'Percentage of executions that required retries'
      unit: 'percentage'
      enabled: true
      surfaces: ['OPERATOR', 'MANAGER']
      source: 'audit_log'
      queryType: 'execution_audit'
      thresholds:
        green: { min: 0, max: 5 } # <5% is excellent
        yellow: { min: 6, max: 15 } # 6-15% needs attention
        red: { min: 16, max: 100 } # >15% is critical

    manual_override_rate:
      key: 'manual_override_rate'
      label: 'Manual Override Rate'
      description: 'Percentage of decisions that required manual overrides'
      unit: 'percentage'
      enabled: true
      surfaces: ['MANAGER', 'EXECUTIVE']
      source: 'audit_log'
      queryType: 'decision_audit'
      thresholds:
        green: { min: 0, max: 10 } # <10% is excellent
        yellow: { min: 11, max: 25 } # 11-25% needs attention
        red: { min: 26, max: 100 } # >25% is critical

  # GOVERNANCE & RISK METRICS
  governanceRisk:
    blocked_actions_count:
      key: 'blocked_actions_count'
      label: 'Blocked Actions Count'
      description: 'Number of actions blocked by governance rules'
      unit: 'count'
      enabled: true
      surfaces: ['MANAGER', 'EXECUTIVE']
      source: 'audit_log'
      queryType: 'governance_audit'
      thresholds:
        green: { min: 0, max: 5 } # <5 is excellent
        yellow: { min: 6, max: 20 } # 6-20 needs attention
        red: { min: 21, max: 999999 } # >20 is critical

    high_risk_decisions_count:
      key: 'high_risk_decisions_count'
      label: 'High-Risk Decisions Count'
      description: 'Number of decisions flagged as high-risk'
      unit: 'count'
      enabled: true
      surfaces: ['MANAGER', 'EXECUTIVE']
      source: 'decisions'
      queryType: 'decision_risk'
      thresholds:
        green: { min: 0, max: 2 } # <2 is excellent
        yellow: { min: 3, max: 10 } # 3-10 needs attention
        red: { min: 11, max: 999999 } # >10 is critical

    drift_events_critical:
      key: 'drift_events_critical'
      label: 'Critical Drift Events'
      description: 'Number of critical drift events detected'
      unit: 'count'
      enabled: true
      surfaces: ['MANAGER', 'EXECUTIVE']
      source: 'drift_events'
      queryType: 'drift_audit'
      thresholds:
        green: { min: 0, max: 0 } # 0 is excellent
        yellow: { min: 1, max: 5 } # 1-5 needs attention
        red: { min: 6, max: 999999 } # >5 is critical

    boundary_violations_critical:
      key: 'boundary_violations_critical'
      label: 'Critical Boundary Violations'
      description: 'Number of critical GHL boundary violations'
      unit: 'count'
      enabled: true
      surfaces: ['EXECUTIVE']
      source: 'audit_log'
      queryType: 'boundary_audit'
      thresholds:
        green: { min: 0, max: 0 } # 0 is excellent
        yellow: { min: 1, max: 3 } # 1-3 needs attention
        red: { min: 4, max: 999999 } # >3 is critical

    voice_enum_compliance_rate:
      key: 'voice_enum_compliance_rate'
      label: 'Voice Enum Compliance Rate'
      description: 'Percentage of voice operations using approved enums'
      unit: 'percentage'
      enabled: true
      surfaces: ['OPERATOR', 'MANAGER']
      source: 'audit_log'
      queryType: 'voice_audit'
      thresholds:
        green: { min: 98, max: 100 } # 98%+ is excellent
        yellow: { min: 90, max: 97 } # 90-97% needs attention
        red: { min: 0, max: 89 } # <90% is critical

    decisions_with_explanations_rate:
      key: 'decisions_with_explanations_rate'
      label: 'Decisions with Explanations Rate'
      description: 'Percentage of decisions that include explanations'
      unit: 'percentage'
      enabled: true
      surfaces: ['MANAGER', 'EXECUTIVE']
      source: 'decisions'
      queryType: 'decision_audit'
      thresholds:
        green: { min: 90, max: 100 } # 90%+ is excellent
        yellow: { min: 70, max: 89 } # 70-89% needs attention
        red: { min: 0, max: 69 } # <70% is critical

  # REVENUE INTEGRITY METRICS
  revenueIntegrity:
    billing_active_tenants_rate:
      key: 'billing_active_tenants_rate'
      label: 'Active Billing Tenants Rate'
      description: 'Percentage of tenants with active billing status'
      unit: 'percentage'
      enabled: true
      surfaces: ['EXECUTIVE']
      source: 'billing'
      queryType: 'billing_status'
      thresholds:
        green: { min: 95, max: 100 } # 95%+ is excellent
        yellow: { min: 85, max: 94 } # 85-94% needs attention
        red: { min: 0, max: 84 } # <85% is critical

    quota_utilization_voice:
      key: 'quota_utilization_voice'
      label: 'Voice Quota Utilization'
      description: 'Percentage of voice minutes quota currently used'
      unit: 'percentage'
      enabled: true
      surfaces: ['EXECUTIVE']
      source: 'usage_meter'
      queryType: 'quota_tracking'
      thresholds:
        green: { min: 0, max: 80 } # <80% is excellent
        yellow: { min: 81, max: 95 } # 81-95% needs attention
        red: { min: 96, max: 100 } # >95% is critical

    billing_sync_failures_count:
      key: 'billing_sync_failures_count'
      label: 'Billing Sync Failures Count'
      description: 'Number of billing synchronization failures'
      unit: 'count'
      enabled: true
      surfaces: ['EXECUTIVE']
      source: 'audit_log'
      queryType: 'billing_audit'
      thresholds:
        green: { min: 0, max: 2 } # <2 is excellent
        yellow: { min: 3, max: 10 } # 3-10 needs attention
        red: { min: 11, max: 999999 } # >10 is critical

    grace_period_tenants_count:
      key: 'grace_period_tenants_count'
      label: 'Grace Period Tenants Count'
      description: 'Number of tenants currently in grace period'
      unit: 'count'
      enabled: true
      surfaces: ['EXECUTIVE']
      source: 'billing'
      queryType: 'billing_status'
      thresholds:
        green: { min: 0, max: 5 } # <5 is excellent
        yellow: { min: 6, max: 20 } # 6-20 needs attention
        red: { min: 21, max: 999999 } # >20 is critical

  # READINESS METRICS
  readiness:
    readiness_overall_green_rate:
      key: 'readiness_overall_green_rate'
      label: 'Overall Readiness Green Rate'
      description: 'Percentage of tenants with GREEN readiness status'
      unit: 'percentage'
      enabled: true
      surfaces: ['EXECUTIVE']
      source: 'readiness'
      queryType: 'readiness_status'
      thresholds:
        green: { min: 90, max: 100 } # 90%+ is excellent
        yellow: { min: 70, max: 89 } # 70-89% needs attention
        red: { min: 0, max: 69 } # <70% is critical

    readiness_blocking_reasons_top:
      key: 'readiness_blocking_reasons_top'
      label: 'Top Blocking Reasons'
      description: 'Most common reasons tenants are blocked'
      unit: 'count'
      enabled: true
      surfaces: ['EXECUTIVE']
      source: 'readiness'
      queryType: 'readiness_status'
      thresholds:
        green: { min: 0, max: 10 } # <10 is excellent
        yellow: { min: 11, max: 50 } # 11-50 needs attention
        red: { min: 51, max: 999999 } # >50 is critical

# Section definitions for organizing metrics
sections:
  salesEffectiveness:
    key: 'salesEffectiveness'
    title: 'Sales Effectiveness'
    description: 'Key metrics tracking sales funnel performance and conversion rates'
    metrics:
      - lead_to_contact_rate
      - contact_to_qualified_rate
      - qualified_to_booked_rate
      - booked_to_consult_done_rate
      - consult_done_to_paid_rate
      - no_show_rate
      - avg_time_in_new_state

  operationalExcellence:
    key: 'operationalExcellence'
    title: 'Operational Excellence'
    description: 'Metrics tracking system performance, SLAs, and execution reliability'
    metrics:
      - sla_breach_rate
      - sla_at_risk_count
      - execution_success_rate
      - retry_rate
      - manual_override_rate

  governanceRisk:
    key: 'governanceRisk'
    title: 'Governance & Risk'
    description: 'Compliance, risk management, and governance metrics'
    metrics:
      - blocked_actions_count
      - high_risk_decisions_count
      - drift_events_critical
      - boundary_violations_critical
      - voice_enum_compliance_rate
      - decisions_with_explanations_rate

  revenueIntegrity:
    key: 'revenueIntegrity'
    title: 'Revenue Integrity'
    description: 'Billing, quota management, and revenue protection metrics'
    metrics:
      - billing_active_tenants_rate
      - quota_utilization_voice
      - billing_sync_failures_count
      - grace_period_tenants_count

  readiness:
    key: 'readiness'
    title: 'Readiness'
    description: 'System readiness and tenant onboarding status metrics'
    metrics:
      - readiness_overall_green_rate
      - readiness_blocking_reasons_top

# Surface-specific configurations
surfaces:
  OPERATOR:
    sections:
      - salesEffectiveness
      - operationalExcellence
      - governanceRisk
    maxMetricsPerSection: 5
    includeTrends: true

  MANAGER:
    sections:
      - salesEffectiveness
      - operationalExcellence
      - governanceRisk
      - revenueIntegrity
    maxMetricsPerSection: 7
    includeTrends: true

  EXECUTIVE:
    sections:
      - salesEffectiveness
      - operationalExcellence
      - governanceRisk
      - revenueIntegrity
      - readiness
    maxMetricsPerSection: 10
    includeTrends: true
    includeDrilldown: true

# Data retention and caching policies
dataRetention:
  auditEventsDays: 90
  metricCacheMinutes: 15
  drilldownCacheMinutes: 5

# Query optimization settings
queryOptimization:
  maxConcurrentQueries: 5
  queryTimeoutSeconds: 30
  enableQueryCaching: true
  cacheTtlMinutes: 10
