---
description: "Enforce single source of truth and prevent documentation drift"
globs: ["**/*"]
alwaysApply: true
---

# No-Drift Policy

## Purpose
This rule enforces the single source of truth principle to eliminate confusion and drift between documentation and implementation.

## Canonical Documentation Hierarchy

### 1. REQUIREMENTS.md (CANONICAL)
- **Purpose**: Definitive product requirements, scope boundaries, user personas
- **Update Trigger**: Any change to product scope, user needs, or feature boundaries
- **Enforcement**: All product decisions must be traceable to REQUIREMENTS.md
- **Violation**: Building features not defined in REQUIREMENTS.md

### 2. TRACEABILITY.md (CANONICAL)
- **Purpose**: Feature-to-test verification matrix ensuring complete test coverage
- **Update Trigger**: Before any feature development begins
- **Enforcement**: No feature development without traceability row
- **Violation**: Shipping features without test coverage mapping

### 3. ARCHITECTURE.md (CANONICAL)
- **Purpose**: System architecture, module boundaries, data flow definitions
- **Update Trigger**: Any architectural change or new component introduction
- **Enforcement**: All code must respect architectural boundaries
- **Violation**: Cross-module dependencies not defined in ARCHITECTURE.md

### 4. DECISIONS/ (CANONICAL)
- **Purpose**: Architecture decisions with context and rationale
- **Update Trigger**: Any architectural or significant technical decision
- **Enforcement**: No architectural changes without ADR documentation
- **Violation**: Undocumented architectural decisions

### 5. PRODUCT_LOG.md (CANONICAL)
- **Purpose**: User-visible changes, milestones, feature decisions
- **Update Trigger**: Any user-facing change or milestone achievement
- **Enforcement**: All releases must be documented in PRODUCT_LOG.md
- **Violation**: User-visible changes not logged

### 6. ENGINEERING_LOG.md (CANONICAL)
- **Purpose**: Technical changes, architectural rationale, engineering decisions
- **Update Trigger**: Architecture/infrastructure/refactor changes
- **Enforcement**: All technical decisions must be logged with "why"
- **Violation**: Technical changes without documented rationale

## Update Requirements

### Before Development Starts
- [ ] Feature defined in REQUIREMENTS.md with acceptance criteria
- [ ] Row added to TRACEABILITY.md with test coverage plan
- [ ] Acceptance criteria written using ACCEPTANCE_CRITERIA.md template

### During Development
- [ ] Tests written according to TEST_STRATEGY.md pyramid
- [ ] Code follows ARCHITECTURE.md boundaries
- [ ] Any architectural decisions documented as ADRs

### Before Merge
- [ ] All governance checkboxes in PR template completed
- [ ] TRACEABILITY.md updated with actual test file paths
- [ ] PRODUCT_LOG.md or ENGINEERING_LOG.md updated
- [ ] ADR created/updated if architectural decision made

## Enforcement Mechanisms

### Automated Rules
- Cursor rules prevent architectural violations
- PR template enforces governance checklist
- CI/CD requires test coverage and documentation updates

### Manual Reviews
- Code reviews check against canonical documents
- Architecture reviews validate against ARCHITECTURE.md
- Product reviews validate against REQUIREMENTS.md

## Drift Prevention

### Regular Audits
- Monthly review of documentation vs. implementation
- Automated checks for outdated references
- Team alignment sessions on canonical documents

### Exception Process
- Documented exceptions require ADR with business justification
- Time-limited exceptions with remediation plan
- No permanent violations allowed

## Consequences of Violations

### Minor Violations
- PR rejection with documentation requirements
- Required updates before merge approval

### Major Violations
- Feature rollback if shipped without proper documentation
- Process review and remediation requirements
- Potential escalation to engineering leadership

## Continuous Improvement

### Metrics Tracking
- Documentation completeness percentage
- Time-to-merge for properly documented PRs
- Defect rates for well-documented features

### Process Refinement
- Regular review of governance effectiveness
- Updates to documentation templates as needed
- Training for new team members on governance requirements