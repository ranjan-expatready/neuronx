
> sales-os@0.1.0 test:integration /Users/ranjansingh/Desktop/NeuronX
> jest apps/core-api/src/rate-limit/__tests__/rate-limit.guard.spec.ts && jest apps/core-api/src/rate-limit/__tests__/webhook-ordering.spec.ts && jest apps/core-api/src/rate-limit/__tests__/rate-limit.redis.store.spec.ts && jest apps/core-api/src/rate-limit/__tests__/rate-limit.store.integration.spec.ts "--" "--runInBand"

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "tenant-a",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 99,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "tenant-b",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 99,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "tenant-a",
  "scope": "api",
  "routeKey": "api/leads/{id}",
  "method": "GET",
  "remaining": 99,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "tenant-b",
  "scope": "api",
  "routeKey": "api/leads/{id}",
  "method": "GET",
  "remaining": 99,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "tenant-1",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 99,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "tenant-1",
  "scope": "webhook",
  "routeKey": "integrations/ghl/webhooks",
  "method": "POST",
  "remaining": 99,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "admin-tenant",
  "scope": "admin",
  "routeKey": "admin/users",
  "method": "GET",
  "remaining": 99,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM    WARN [RateLimitGuard] Rate limit blocked
[Nest] 96644  - 01/10/2026, 7:04:42 PM    WARN [RateLimitGuard] Object:
{
  "allowed": false,
  "tenantId": "tenant-1",
  "scope": "webhook",
  "routeKey": "webhooks/stripe",
  "method": "POST",
  "remaining": 0,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  },
  "retryAfter": 60,
  "reason": "rate_limit_exceeded"
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   ERROR [RateLimitGuard] Rate limiting error
[Nest] 96644  - 01/10/2026, 7:04:42 PM   ERROR [RateLimitGuard] Object:
{
  "error": "Rate limit exceeded",
  "url": "/webhooks/stripe",
  "method": "POST",
  "stack": "HttpException: Rate limit exceeded\n    at RateLimitGuard.handleRateLimitViolation (/Users/ranjansingh/Desktop/NeuronX/apps/core-api/src/rate-limit/rate-limit.guard.ts:268:11)\n    at RateLimitGuard.canActivate (/Users/ranjansingh/Desktop/NeuronX/apps/core-api/src/rate-limit/rate-limit.guard.ts:72:21)\n    at Object.<anonymous> (/Users/ranjansingh/Desktop/NeuronX/apps/core-api/src/rate-limit/__tests__/rate-limit.guard.spec.ts:195:7)"
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "tenant-1",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 95,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 20,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 19,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 18,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 17,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 16,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 15,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 14,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 13,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 12,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 11,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 10,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 9,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 8,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 7,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 6,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 5,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 4,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 3,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 2,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 1,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 0,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": -1,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": -2,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": -3,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": -4,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-exceed-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 19,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-exceed-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 18,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-exceed-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 17,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-exceed-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 16,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-exceed-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 15,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-exceed-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 14,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-exceed-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 13,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-exceed-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 12,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-exceed-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 11,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-exceed-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 10,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-exceed-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 9,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-exceed-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 8,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-exceed-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 7,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-exceed-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 6,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-exceed-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 5,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-exceed-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 4,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-exceed-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 3,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-exceed-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 2,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-exceed-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 1,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "burst-exceed-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 0,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM    WARN [RateLimitGuard] Rate limit blocked
[Nest] 96644  - 01/10/2026, 7:04:42 PM    WARN [RateLimitGuard] Object:
{
  "allowed": false,
  "tenantId": "burst-exceed-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 0,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  },
  "retryAfter": 60,
  "reason": "rate_limit_exceeded"
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   ERROR [RateLimitGuard] Rate limiting error
[Nest] 96644  - 01/10/2026, 7:04:42 PM   ERROR [RateLimitGuard] Object:
{
  "error": "Rate limit exceeded",
  "url": "/api/leads",
  "method": "GET",
  "stack": "HttpException: Rate limit exceeded\n    at RateLimitGuard.handleRateLimitViolation (/Users/ranjansingh/Desktop/NeuronX/apps/core-api/src/rate-limit/rate-limit.guard.ts:268:11)\n    at RateLimitGuard.canActivate (/Users/ranjansingh/Desktop/NeuronX/apps/core-api/src/rate-limit/rate-limit.guard.ts:72:21)\n    at Object.<anonymous> (/Users/ranjansingh/Desktop/NeuronX/apps/core-api/src/rate-limit/__tests__/rate-limit.guard.spec.ts:262:7)"
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM    WARN [RateLimitGuard] Rate limit blocked
[Nest] 96644  - 01/10/2026, 7:04:42 PM    WARN [RateLimitGuard] Object:
{
  "allowed": false,
  "tenantId": "rate-limited-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "POST",
  "remaining": 0,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  },
  "retryAfter": 120,
  "reason": "rate_limit_exceeded"
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   ERROR [RateLimitGuard] Rate limiting error
[Nest] 96644  - 01/10/2026, 7:04:42 PM   ERROR [RateLimitGuard] Object:
{
  "error": "Rate limit exceeded",
  "url": "/api/leads",
  "method": "POST",
  "stack": "HttpException: Rate limit exceeded\n    at RateLimitGuard.handleRateLimitViolation (/Users/ranjansingh/Desktop/NeuronX/apps/core-api/src/rate-limit/rate-limit.guard.ts:268:11)\n    at RateLimitGuard.canActivate (/Users/ranjansingh/Desktop/NeuronX/apps/core-api/src/rate-limit/rate-limit.guard.ts:72:21)\n    at Object.<anonymous> (/Users/ranjansingh/Desktop/NeuronX/apps/core-api/src/rate-limit/__tests__/rate-limit.guard.spec.ts:294:7)"
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "success-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 95,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   ERROR [RateLimitGuard] Rate limiting error
[Nest] 96644  - 01/10/2026, 7:04:42 PM   ERROR [RateLimitGuard] Object:
{
  "error": "Policy service error",
  "url": "/api/leads",
  "method": "GET",
  "stack": "Error: Policy service error\n    at Object.<anonymous> (/Users/ranjansingh/Desktop/NeuronX/apps/core-api/src/rate-limit/__tests__/rate-limit.guard.spec.ts:331:66)\n    at Promise.then.completed (/Users/ranjansingh/Desktop/NeuronX/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/ranjansingh/Desktop/NeuronX/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/ranjansingh/Desktop/NeuronX/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:316:40)\n    at _runTest (/Users/ranjansingh/Desktop/NeuronX/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/ranjansingh/Desktop/NeuronX/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/ranjansingh/Desktop/NeuronX/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/ranjansingh/Desktop/NeuronX/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/ranjansingh/Desktop/NeuronX/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/ranjansingh/Desktop/NeuronX/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/ranjansingh/Desktop/NeuronX/node_modules/.pnpm/jest-circus@29.7.0/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/ranjansingh/Desktop/NeuronX/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/ranjansingh/Desktop/NeuronX/node_modules/.pnpm/jest-runner@29.7.0/node_modules/jest-runner/build/runTest.js:444:34)"
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM    WARN [RateLimitGuard] Rate limit blocked
[Nest] 96644  - 01/10/2026, 7:04:42 PM    WARN [RateLimitGuard] Object:
{
  "allowed": false,
  "tenantId": "unknown",
  "scope": "admin",
  "routeKey": "admin/dashboard",
  "method": "GET",
  "remaining": 0,
  "tenantConfidence": "low",
  "policy": {
    "limitPerMinute": 10,
    "burst": 2
  },
  "retryAfter": 60,
  "reason": "rate_limit_exceeded"
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   ERROR [RateLimitGuard] Rate limiting error
[Nest] 96644  - 01/10/2026, 7:04:42 PM   ERROR [RateLimitGuard] Object:
{
  "error": "Rate limit exceeded",
  "url": "/admin/dashboard",
  "method": "GET",
  "stack": "HttpException: Rate limit exceeded\n    at RateLimitGuard.handleRateLimitViolation (/Users/ranjansingh/Desktop/NeuronX/apps/core-api/src/rate-limit/rate-limit.guard.ts:268:11)\n    at RateLimitGuard.canActivate (/Users/ranjansingh/Desktop/NeuronX/apps/core-api/src/rate-limit/rate-limit.guard.ts:72:21)\n    at Object.<anonymous> (/Users/ranjansingh/Desktop/NeuronX/apps/core-api/src/rate-limit/__tests__/rate-limit.guard.spec.ts:359:7)"
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "webhook-tenant",
  "scope": "webhook",
  "routeKey": "integrations/ghl/webhooks",
  "method": "POST",
  "remaining": 99,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "stripe-tenant",
  "scope": "webhook",
  "routeKey": "webhooks/stripe",
  "method": "POST",
  "remaining": 99,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM    WARN [RateLimitGuard] Rate limit blocked
[Nest] 96644  - 01/10/2026, 7:04:42 PM    WARN [RateLimitGuard] Object:
{
  "allowed": false,
  "tenantId": "compromised-tenant",
  "scope": "webhook",
  "routeKey": "webhooks/stripe",
  "method": "POST",
  "remaining": 0,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  },
  "retryAfter": 300,
  "reason": "rate_limit_exceeded"
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   ERROR [RateLimitGuard] Rate limiting error
[Nest] 96644  - 01/10/2026, 7:04:42 PM   ERROR [RateLimitGuard] Object:
{
  "error": "Rate limit exceeded",
  "url": "/webhooks/stripe",
  "method": "POST",
  "stack": "HttpException: Rate limit exceeded\n    at RateLimitGuard.handleRateLimitViolation (/Users/ranjansingh/Desktop/NeuronX/apps/core-api/src/rate-limit/rate-limit.guard.ts:268:11)\n    at RateLimitGuard.canActivate (/Users/ranjansingh/Desktop/NeuronX/apps/core-api/src/rate-limit/rate-limit.guard.ts:72:21)\n    at Object.<anonymous> (/Users/ranjansingh/Desktop/NeuronX/apps/core-api/src/rate-limit/__tests__/rate-limit.guard.spec.ts:436:7)"
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "test",
  "scope": "api",
  "routeKey": "api/leads/{id}",
  "method": "GET",
  "remaining": 99,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "test",
  "scope": "api",
  "routeKey": "api/leads/{id}",
  "method": "GET",
  "remaining": 99,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "test",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "POST",
  "remaining": 99,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "enterprise-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 99,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 10000,
    "burst": 2000
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "free-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 99,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 10
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "unknown",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 99,
  "tenantConfidence": "low",
  "policy": {
    "limitPerMinute": 10,
    "burst": 2
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "webhook-tenant",
  "scope": "webhook",
  "routeKey": "integrations/ghl/webhooks",
  "method": "POST",
  "remaining": 99,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Rate limit allowed
[Nest] 96644  - 01/10/2026, 7:04:42 PM   DEBUG [RateLimitGuard] Object:
{
  "allowed": true,
  "tenantId": "api-tenant",
  "scope": "api",
  "routeKey": "api/leads",
  "method": "GET",
  "remaining": 99,
  "tenantConfidence": "high",
  "policy": {
    "limitPerMinute": 100,
    "burst": 20
  }
}

PASS apps/core-api/src/rate-limit/__tests__/rate-limit.guard.spec.ts
  RateLimitGuard - FAANG-grade Rate Limiting
    Tenant Isolation - Rate Limit Separation
      ✓ should apply different rate limits for different tenants (4 ms)
      ✓ should maintain tenant isolation even with same route patterns (1 ms)
    Scope Separation - API vs Webhook Isolation
      ✓ should apply different scopes for API vs webhook requests (2 ms)
      ✓ should apply admin scope for admin endpoints
      ✓ should not allow webhook scope to affect API limits (9 ms)
    Burst Behavior - Token Bucket Algorithm
      ✓ should allow burst requests up to burst limit (6 ms)
      ✓ should block requests after burst limit is exceeded (6 ms)
    Retry-After Response - Proper HTTP Headers
      ✓ should set proper retry-after headers when rate limited (1 ms)
      ✓ should include rate limit headers on successful requests (1 ms)
    Fail-Open vs Fail-Closed Semantics
      ✓ should fail_closed for API requests when rate limiting fails (2 ms)
      ✓ should fail_closed for admin endpoints with unknown tenant (3 ms)
      ✓ should never block health check endpoints (1 ms)
    Webhook Flow Ordering - Security First
      ✓ should apply rate limiting to webhook endpoints
      ✓ should include provider ID in webhook rate limit keys (1 ms)
      ✓ should handle invalid signature followed by rate limiting
    Route Key Generation - Endpoint Grouping
      ✓ should group similar API endpoints together (1 ms)
      ✓ should exclude health endpoints from rate limiting
    Entitlement-Aware Policies
      ✓ should apply different policies based on tenant tier (1 ms)
      ✓ should apply conservative policies for unknown tenants
    Global Disable Functionality
      ✓ should bypass rate limiting when globally disabled
    Webhook Security Ordering - Signature Before Rate Limit
      ✓ should not apply rate limiting to webhook endpoints (guard bypassed) (1 ms)
      ✓ should still apply rate limiting to API endpoints (1 ms)

Test Suites: 1 passed, 1 total
Tests:       22 passed, 22 total
Snapshots:   0 total
Time:        0.469 s, estimated 1 s
Ran all test suites matching /apps\/core-api\/src\/rate-limit\/__tests__\/rate-limit.guard.spec.ts/i.
FAIL apps/core-api/src/rate-limit/__tests__/webhook-ordering.spec.ts
  ● Test suite failed to run

    TypeError: Cannot read properties of undefined (reading 'value')

      19 |    * Process GHL webhooks with correct security ordering:
      20 |    * 1. Signature verification (cheap reject if invalid)
    > 21 |    * 2. Rate limiting (tenant/provider scoped)
         |                                        ^
      22 |    * 3. Business processing
      23 |    */
      24 |   @Post()

      at node_modules/.pnpm/@nestjs+common@10.4.21_reflect-metadata@0.1.14_rxjs@7.8.2/node_modules/@nestjs/common/decorators/http/request-mapping.decorator.js:15:76
      at Object.<anonymous>.__esDecorate (apps/core-api/src/integrations/ghl/ghl-webhook.controller.ts:21:40)
      at Function.<static_initializer> (apps/core-api/src/integrations/ghl/ghl-webhook.controller.ts:25:3)
      at apps/core-api/src/integrations/ghl/ghl-webhook.controller.ts:48:32
      at Object.<anonymous> (apps/core-api/src/integrations/ghl/ghl-webhook.controller.ts:178:3)
      at Object.<anonymous> (apps/core-api/src/rate-limit/__tests__/webhook-ordering.spec.ts:35:1)

Test Suites: 1 failed, 1 total
Tests:       0 total
Snapshots:   0 total
Time:        0.447 s
Ran all test suites matching /apps\/core-api\/src\/rate-limit\/__tests__\/webhook-ordering.spec.ts/i.
 ELIFECYCLE  Command failed with exit code 1.
0
