# GHL Boundary Enforcement Policy
# Defines what GHL is allowed to do (execution surface only)
# Read-only enforcement - does not modify GHL configurations

enforcementMode: monitor_only # monitor_only | block

# Business Logic Definition
# What constitutes "business logic" that must remain in NeuronX
businessLogicRules:
  - name: decision_logic
    description: 'Conditional logic that implies business decisions'
    patterns:
      - 'condition.*score.*>'
      - 'condition.*priority.*='
      - 'condition.*status.*=='
      - 'condition.*stage.*!='

  - name: scoring_logic
    description: 'Lead scoring algorithms'
    patterns:
      - 'calculate.*score'
      - 'update.*score'
      - "set.*score.*\\+"
      - "score.*\\*.*weight"

  - name: routing_logic
    description: 'Lead routing decisions'
    patterns:
      - 'assign.*to.*team'
      - 'route.*to.*user'
      - 'transfer.*to.*agent'

  - name: escalation_logic
    description: 'SLA and escalation decisions'
    patterns:
      - 'escalate.*if.*overdue'
      - 'notify.*manager.*if'
      - 'flag.*urgent'

# Allowed Workflow Actions (Execution Surface Only)
allowedWorkflowActions:
  # Communication actions
  - send_email
  - send_sms
  - send_whatsapp
  - make_call
  - schedule_call

  # Data operations (pure execution)
  - update_contact
  - update_opportunity
  - create_task
  - update_task
  - create_note
  - update_note

  # Calendar operations
  - create_calendar_event
  - update_calendar_event
  - cancel_calendar_event

  # Pipeline operations (stage transitions only)
  - move_to_stage
  - update_pipeline_status

# Denied Workflow Actions (Business Logic)
deniedWorkflowActions:
  # Decision-making actions
  - qualify_lead
  - disqualify_lead
  - mark_as_won
  - mark_as_lost
  - create_proposal
  - send_contract

  # Scoring actions
  - calculate_score
  - update_score
  - apply_scoring_model

  # Complex routing
  - auto_assign
  - smart_routing
  - round_robin_assign

# Pipeline Mutations (Stage Transitions)
allowedPipelineMutations:
  - move_to_stage
  - update_status
  - add_note

deniedPipelineMutations:
  - create_custom_stage
  - delete_stage
  - modify_stage_rules
  - change_pipeline_flow

# AI Worker Capabilities (Evidence-based only)
allowedAiWorkerCapabilities:
  - generate_email_content
  - generate_sms_content
  - generate_call_script
  - analyze_sentiment
  - extract_keywords
  - summarize_conversation

deniedAiWorkerCapabilities:
  - make_decisions
  - qualify_leads
  - route_leads
  - calculate_scores
  - predict_outcomes

# Complexity Thresholds
thresholds:
  maxActionsPerWorkflow: 20
  maxConditionDepth: 2
  maxBranchCount: 5
  maxTriggerCount: 10

# Webhook Security
requireNeuronxTokenHeaderOnWebhookCalls: true

# Risk Classification Rules
riskClassificationRules:
  unknownActionType:
    severity: LOW
    requiresReview: false

  complexConditionTree:
    severity: MEDIUM
    requiresReview: true

  businessLogicPattern:
    severity: HIGH
    requiresReview: true

  unapprovedStageTransition:
    severity: CRITICAL
    requiresReview: true

# Severity Mapping
severityLevels:
  LOW:
    description: 'Minor policy violations, monitoring recommended'
    blocksTenant: false
  MEDIUM:
    description: 'Moderate violations requiring attention'
    blocksTenant: false
  HIGH:
    description: 'Severe violations that should block operations'
    blocksTenant: true
  CRITICAL:
    description: 'Critical violations that must block tenant'
    blocksTenant: true

# Violation Categories (for reporting)
violationCategories:
  LOGIC_IN_WORKFLOW: 'Business logic embedded in workflow conditions'
  UNAPPROVED_STAGE_TRANSITION: 'Pipeline stage changes not matching NeuronX FSM'
  UNAPPROVED_AUTOMATION_ACTION: 'Actions that perform business decisions'
  AI_WORKER_UNSCOPED_ACTIONS: 'AI performing decisions instead of evidence gathering'
  WEBHOOK_BYPASS_RISK: 'Webhooks calling endpoints without NeuronX authority'
  UNKNOWN_RISK: 'Unrecognized action types requiring classification'
